**归一化思路**

- 统一把输入拆成 IEEE-754 的 sign、exponent、mantissa，并只用 mantissa 作为插值自变量：
  - 解码位置：[s_in_sign/s_in_exponent/s_in_mantiza](file:///c:/Users/10694/Desktop/SFU-Piecewise-Polynomial-Approximation/Description/SFU_00/SFU/Quadratic_Interpolator/Quadratic_Interpolator.v#L51-L53)
  - mantissa 在硬件上被分成段索引 s_X1=mantissa[22:16] 和插值量 s_X2=mantissa[16:0]/[15:0]：[s_X1/s_X2](file:///c:/Users/10694/Desktop/SFU-Piecewise-Polynomial-Approximation/Description/SFU_00/SFU/Quadratic_Interpolator/Quadratic_Interpolator.v#L54-L60)
- 不同函数的“归一化域”不同，但都用尾数的高位均匀分段（64 或 128 段）：
  - 7 位段索引（128 段）：rsqrt、ln2（一般情况）、1/x 等
  - 6 位段索引（64 段）：sin/cos、ln2 指数为 0 的特例、exp2、sqrt 两套

**各函数的归一化规则**

- log2(x)：x = 2^(E−127) · M，M∈[1,2)
  - 只对 M 在 (1,2) 做插值，整数部分直接用 E−127 叠加
  - 符号由 x<1 决定（E<127 → 负）：[log2 后处理](file:///c:/Users/10694/Desktop/SFU-Piecewise-Polynomial-Approximation/Description/SFU_00/SFU/sfu.v#L119-L144)
  - E=127（无偏指数 0）时用 ln2e0 的专用表：[选择信号](file:///c:/Users/10694/Desktop/SFU-Piecewise-Polynomial-Approximation/Description/SFU_00/SFU/Quadratic_Interpolator/Quadratic_Interpolator.v#L76-L78)
- 1/x：x = 2^(E−127) · M，M∈[1,2)
  - ###### 归一化到 M∈(1,2)，插值近似 1/M，然后整体缩放 2^{−(E−127)}（在主模块组合后处理）
  - 使用 7 位地址的表：reci
- sqrt(x)：x = 2^(E−127) · M，M∈[1,2)
  - 若 E−127 为偶数：sqrt(x)=2^{(E−127)/2} · sqrt(M)，用 sqrt_1_2 表
  - 若为奇数：sqrt(x)=2^{(E−128)/2} · sqrt(2M)，用 sqrt_2_4 表（域变到 (2,4)）
  - 通过指数奇偶选择两套系数表：[奇偶选择与表映射](file:///c:/Users/10694/Desktop/SFU-Piecewise-Polynomial-Approximation/Description/SFU_00/SFU/Quadratic_Interpolator/Quadratic_Interpolator.v#L83-L87)；ROM 接线见 [ROM.vhd](file:///c:/Users/10694/Desktop/SFU-Piecewise-Polynomial-Approximation/Description/SFU_00/SFU/Quadratic_Interpolator/ROM.vhd#L80-L91)
- 1/√x：与 sqrt 相同的指数奇偶划分，分别用 reic_sqrt_1_2 与 reic_sqrt_2_4 的表（7 位地址）
- 2^x（exp2）：x = k + r，r∈(0,1)
  - 归一化到 r∈(0,1) 做插值近似 2^r，整体再乘 2^k
  - 使用 6 位地址的表：exp
- sin/cos：将角度折返到 [0,1) 的基本区间
  - 若输入“≥1”（以位判别），做 π/2−x 折返使插值自变量落入 [0,1)
  - 同时根据象限与输入位决定是 sin 还是 cos、正负号等：[折返与象限处理](file:///c:/Users/10694/Desktop/SFU-Piecewise-Polynomial-Approximation/Description/SFU_00/SFU/sfu.v#L107-L118)

**分段与地址映射**

- 段索引 s_X1 = mantissa[22:16]，这是均匀分段的本质：[s_X1 提取](file:///c:/Users/10694/Desktop/SFU-Piecewise-Polynomial-Approximation/Description/SFU_00/SFU/Quadratic_Interpolator/Quadratic_Interpolator.v#L56-L60)
- ROM 根据具体 LUT 的地址位宽选择 6 位或 7 位：
  - 6 位：使用 addr[add_bits−1:1]，例如 sin/cos/exp/sqrt：[ROM 接线示例](file:///c:/Users/10694/Desktop/SFU-Piecewise-Polynomial-Approximation/Description/SFU_00/SFU/Quadratic_Interpolator/ROM.vhd#L32-L41)
  - 7 位：使用完整 addr，例如 rsqrt/ln2/reciprocal：[ROM 接线示例](file:///c:/Users/10694/Desktop/SFU-Piecewise-Polynomial-Approximation/Description/SFU_00/SFU/Quadratic_Interpolator/ROM.vhd#L44-L61)

**归一化在代码中的落点**

- 插值模块只见到“归一化后的自变量”：s_X1/s_X2 来自 mantissa 位选，[ROM 获取 C0/C1/C2](file:///c:/Users/10694/Desktop/SFU-Piecewise-Polynomial-Approximation/Description/SFU_00/SFU/Quadratic_Interpolator/Quadratic_Interpolator.v#L95-L101)，之后平方与融合累加树完成二次插值：[插值流水线](file:///c:/Users/10694/Desktop/SFU-Piecewise-Polynomial-Approximation/Description/SFU_00/SFU/Quadratic_Interpolator/Quadratic_Interpolator.v#L105-L120)
- “整体缩放/符号/整数部分”由顶层 sfu 做（例如 log2 叠加整数部分、sin/cos 象限符号调整），这是把归一化域上的近似结果还原到原始输入域的关键：[sfu 顶层后处理](file:///c:/Users/10694/Desktop/SFU-Piecewise-Polynomial-Approximation/Description/SFU_00/SFU/sfu.v#L119-L144)
